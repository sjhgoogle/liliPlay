<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Lip Mask Debug</title>
    <style>
      body {
        background: #111;
      }
      canvas {
        border: 1px solid #444;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>

    <script>
      const img = new Image();
      img.src = "an2.jpg";

      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      const faceMesh = new FaceMesh({
        locateFile: (f) =>
          `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${f}`,
      });

      faceMesh.setOptions({
        maxNumFaces: 1,
        refineLandmarks: true,
      });

      const LIPS = [
        61, 146, 91, 181, 84, 17, 314, 405, 321, 375, 291, 308, 324, 318, 402,
        317, 14, 87, 178, 88, 95, 185, 40, 39, 37, 0, 267, 269, 270, 409, 415,
        310,
      ];

      img.onload = async () => {
        canvas.width = img.width;
        canvas.height = img.height;
        await faceMesh.send({ image: img });
      };

      faceMesh.onResults((res) => {
        ctx.drawImage(img, 0, 0);

        if (!res.multiFaceLandmarks) return;
        const lm = res.multiFaceLandmarks[0];

        // lip polygon
        ctx.beginPath();
        LIPS.forEach((i, idx) => {
          const p = lm[i];
          const x = p.x * canvas.width;
          const y = p.y * canvas.height;
          if (idx === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        });
        ctx.closePath();

        // fill lips blue
        ctx.fillStyle = "rgba(0,0,255,0.5)";
        ctx.fill();

        // outline
        ctx.strokeStyle = "cyan";
        ctx.lineWidth = 2;
        ctx.stroke();
      });
    </script>
  </body>
</html>
